<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>main.ino</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="setup"></a><a name="Topic11"></a><div class="CTopic TFunction LC first">
 <div class="CTitle">setup</div>
 <div class="CBody"><ul><li><p>Sets the baudrate for the Serial communications.</p></li><li><p>Initializes the CAN-related functions.</p></li><li><p>Initializes the global Strings objects used to compile data.</p></li><li><p>Initialize the gids ( geographic ids ) array before use.</p></li><li><p>Initializes the SD-related functions.</p></li><li><p>Open the CONFIG.txt file, read and load to ram.</p></li><li><p>Display the settings read from CONFIG.txt.</p></li><li><p>Set the GPIO RELAYPIN to output.</p></li></ul><div class="CHeading">Parameters</div><p>n/a</p><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p><a href="../index.html#File:can_library.ino:init_can" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,26);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >init_can</a> <a href="../index.html#File:can_library.ino:init_strings" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,27);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >init_strings</a> <a href="../index.html#File:sd_library.ino:init_gids" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,3);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >init_gids</a> &lt;init_sd&gt; <a href="../index.html#File:sd_library.ino:open_config" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,4);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >open_config</a></p></div>
</div>

<a name="loop"></a><a name="Topic12"></a><div class="CTopic TFunction LC">
 <div class="CTitle">loop</div>
 <div class="CBody"><p>Run the <a href="../index.html#File:main.ino:getATCommand" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,13);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >getATcommand</a> in loop.</p></div>
</div>

<a name="getATCommand"></a><a name="Topic13"></a><div class="CTopic TFunction LC">
 <div class="CTitle">getATCommand</div>
 <div class="CBody"><p>Take in-line serial input and execute AT command</p></div>
</div>

<a name="operation"></a><a name="Topic48"></a><div class="CTopic TFunction LC">
 <div class="CTitle">operation</div>
 <div class="CBody"><p>Remove specific characters unnecessary for data interpretation.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">types</td><td class="CDLDefinition"><p>integer that determines the kind of data requested from the sensor</p></td></tr><tr><td class="CDLEntry">mode</td><td class="CDLDefinition"><p>integer that determines which DATALOGGER receives the sent data. <b>1- ARQ</b> <b>2- Xbee</b></p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p><a href="../index.html#File:main.ino:loop" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,12);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >loop</a></p><div class="CHeading">Global Variables</div><p>g_final_dump, g_sensor_version, text_message</p></div>
</div>

<a name="getArguments"></a><a name="Topic14"></a><div class="CTopic TFunction LC">
 <div class="CTitle">getArguments</div>
 <div class="CBody"><p>Read in-line serial AT command.</p></div>
</div>

<a name="Data_Gathering_Functions"></a><a name="Topic17"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Data Gathering Functions</div>
</div>

<a name="read_data_from_column"></a><a name="Topic25"></a><div class="CTopic TFunction LC">
 <div class="CTitle">read_data_from_column</div>
 <div class="CBody"><p>Sequentially samples data from the sensor column.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">column_data</td><td class="CDLDefinition"><p>char array that will store the raw data received from the sensors</p></td></tr><tr><td class="CDLEntry">sensor_version</td><td class="CDLDefinition"><p>integer that states the sensor version</p></td></tr><tr><td class="CDLEntry">types</td><td class="CDLDefinition"><p>integer that determines the kind of data requested from the sensor</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p><a href="../index.html#File:main.ino:operation" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,48);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >operation</a></p></div>
</div>

<a name="read_current"></a><a name="Topic51"></a><div class="CTopic TFunction LC">
 <div class="CTitle">read_current()</div>
 <div class="CBody"><p>Reads the current draw from the onboard ina219.</p></div>
</div>

<a name="read_voltage"></a><a name="Topic52"></a><div class="CTopic TFunction LC">
 <div class="CTitle">read_voltage()</div>
 <div class="CBody"><p>Reads the <b>Bus Voltage</b>, <b>Shunt Voltage</b>, <b>Load Voltage</b> from the onboard ina219.</p></div>
</div>

<a name="getTimestamp"></a><a name="Topic53"></a><div class="CTopic TFunction LC">
 <div class="CTitle">getTimestamp()</div>
 <div class="CBody"><p>Extract the timestamp from either the ARQCMD or the Xbee.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">mode</td><td class="CDLDefinition"><p>integer Despacito</p></td></tr></table><div class="CHeading">Returns</div><p>Despacito</p><div class="CHeading">See Also</div><p>&lt;poll_data&gt;</p></div>
</div>

<a name="wait_arq_cmd"></a><a name="Topic49"></a><div class="CTopic TFunction LC">
 <div class="CTitle">wait_arq_cmd</div>
 <div class="CBody"><p>Determine the types of data to be sampled from the sensors based on given ARQCMD.&nbsp; ARQCMD is read from the defined DATALOGGER.</p><div class="CHeading">Parameters</div><p>n/a</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>tilt</p></td></tr><tr><td class="CDLEntry">2</td><td class="CDLDefinition"><p>tilt and soil moisture</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:loop" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,12);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >loop</a></p></li></ul></div>
</div>

<a name="Data_parsing_functions"></a><a name="Topic10"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Data parsing functions</div>
</div>

<a name="build_txt_msgs"></a><a name="Topic18"></a><div class="CTopic TFunction LC">
 <div class="CTitle">build_txt_msgs</div>
 <div class="CBody"><p>Build the text messages to be sent.</p><ul><li><p>Splits the data though the delimiter &quot;+&quot;</p></li><li><p>The identifier, and cutoff are identified based on the type of data.</p></li><li><p>Extra characters are removed via <a href="../index.html#File:main.ino:remove_extra_characters" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,19);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >remove_extra_characters</a>.</p></li><li><p>Data is stored in SD card via <a href="../index.html#File:sd_library.ino:writeData" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,9);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >writeData</a>.</p></li><li><p>The following are appended to the data split as text messages to be sent:</p><ul><li><p>delimiters</p></li><li><p>mastername</p></li><li><p>padding for the numerator /&nbsp; denominator</p></li><li><p>identifier</p></li><li><p>timestamp</p></li></ul></li><li><p>The delimiter is a &quot;+&quot;</p></li><li><p>The appended data is copied per character to a temporary buffer.</p></li><li><p>The temporary buffer is split per message.</p></li><li><p>The pads are overwritten with the proper text message length, numerator and denominator.</p></li><li><p>These are then stored to the <b>destination</b> variable.</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">source</td><td class="CDLDefinition"><p>char array that contains the aggregated data</p></td></tr><tr><td class="CDLEntry">destination</td><td class="CDLDefinition"><p>char array that will contain the text messages to be sent separated by the delimiter &quot;+&quot;</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:check_cutoff" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,24);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >check_cutoff</a></p></li><li><p><a href="../index.html#File:main.ino:remove_extra_characters" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,19);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >remove_extra_characters</a></p></li><li><p><a href="../index.html#File:sd_library.ino:writeData" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,9);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >writeData</a></p></li></ul></div>
</div>

<a name="remove_extra_characters"></a><a name="Topic19"></a><div class="CTopic TFunction LC">
 <div class="CTitle">remove_extra_characters</div>
 <div class="CBody"><p>Remove specific characters unnecessary for data interpretation.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">columnData</td><td class="CDLDefinition"><p>char array that contains data split by datatype.</p></td></tr><tr><td class="CDLEntry">cmd</td><td class="CDLDefinition"><p>integer that determines which format is executed</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p>&lt;poll_data&gt;</p></div>
</div>

<a name="tokenize_data_by_data_type"></a><a name="Topic20"></a><div class="CTopic TFunction LC">
 <div class="CTitle">tokenize_data_by_data_type</div>
 <div class="CBody"><p>Remove specific characters unnecessary for data interpretation.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">tokens</td><td class="CDLDefinition"><p>two dimensional char array that will contain the data split by data type.</p></td></tr><tr><td class="CDLEntry">source</td><td class="CDLDefinition"><p>char array that contains the data that will be split.</p></td></tr><tr><td class="CDLEntry">isDebug</td><td class="CDLDefinition"><p>boolean</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p>&lt;poll_data&gt;</p></div>
</div>

<a name="tokenize_data_by_message"></a><a name="Topic21"></a><div class="CTopic TFunction LC">
 <div class="CTitle">tokenize_data_by_message</div>
 <div class="CBody"><p>Arrange the split data into a two dimensional array for convenient access.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">message_array</td><td class="CDLDefinition"><p>two dimensional char array that will contain the data split by cutoff_length. This will be the data in each text message.</p></td></tr><tr><td class="CDLEntry">source</td><td class="CDLDefinition"><p>char array that contains the data that will be split.</p></td></tr><tr><td class="CDLEntry">message_count</td><td class="CDLDefinition"><p>integer count of messages per data type.</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><p>&lt;poll_data&gt;</p></div>
</div>

<a name="message_content_parameters"></a><a name="Topic22"></a><div class="CTopic TFunction LC">
 <div class="CTitle">message_content_parameters</div>
 <div class="CBody"><p>Determine the following:</p><ul><li><p>number of messages to be sent for each data type</p></li><li><p>identifier for each message to be sent</p></li><li><p>number of characters for each message to be sent depending on the data type</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">parameters</td><td class="CDLDefinition"><p>integer array that contains the number of messages to be sent, ascii symbol number corresponding to the identifier, and the number of characters for a given message</p></td></tr><tr><td class="CDLEntry">source_by_dtype</td><td class="CDLDefinition"><p>char array of data to be sent split by data type.</p></td></tr></table><div class="CHeading">Returns</div><p>n/a</p><div class="CHeading">See Also</div><ul><li><p>&lt;poll_data&gt;</p></li><li><p><a href="../index.html#File:main.ino:check_identifier" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,23);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >check_identifier</a></p></li><li><p><a href="../index.html#File:main.ino:check_cutoff" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,24);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >check_cutoff</a></p></li></ul></div>
</div>

<a name="check_identifier"></a><a name="Topic23"></a><div class="CTopic TFunction LC">
 <div class="CTitle">check_identifier</div>
 <div class="CBody"><p>Determine the identifier based on the message id of the message.&nbsp; The starting position of the message id is determined by the index_msgid.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">token</td><td class="CDLDefinition"><p>char array containing the data split by data type.</p></td></tr><tr><td class="CDLEntry">index_msgid</td><td class="CDLDefinition"><p>integer index of the start of the message id.</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">idfier</td><td class="CDLDefinition"><p>char identifier</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:message_content_parameters" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,22);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >message_content_parameters</a></p></li></ul></div>
</div>

<a name="check_cutoff"></a><a name="Topic24"></a><div class="CTopic TFunction LC">
 <div class="CTitle">check_cutoff</div>
 <div class="CBody"><p>Determine the number of characters depending on the identifier</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">idf</td><td class="CDLDefinition"><p>char identifier</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">cutoff</td><td class="CDLDefinition"><p>integer number of characters per message</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:message_content_parameters" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,22);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >message_content_parameters</a></p></li></ul></div>
</div>

<a name="Auxilliary_Control_Functions"></a><a name="Topic57"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Auxilliary Control Functions</div>
</div>

<a name="shut_down"></a><a name="Topic54"></a><div class="CTopic TFunction LC">
 <div class="CTitle">shut_down()</div>
 <div class="CBody"><p>Sends a shutdown command to the 328 PowerModule.</p></div>
</div>

<a name="turn_on_column"></a><a name="Topic15"></a><div class="CTopic TFunction LC">
 <div class="CTitle">turn_on_column</div>
 <div class="CBody"><p>Assert GPIO ( defined by RELAYPIN ) high to turn on sensor column.</p></div>
</div>

<a name="turn_off_column"></a><a name="Topic16"></a><div class="CTopic TFunction LC">
 <div class="CTitle">turn_off_column</div>
 <div class="CBody"><p>Assert GPIO ( defined by RELAYPIN ) low to turn off sensor column.</p></div>
</div>

<a name="Sending_Related_Functions"></a><a name="Topic58"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Sending Related Functions</div>
</div>

<a name="send_data"></a><a name="Topic50"></a><div class="CTopic TFunction LC">
 <div class="CTitle">send_data</div>
 <div class="CBody"><ul><li><p>Sends data to the defined DATALOGGER serial.</p></li><li><p>Manages the retry for sending.</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">isDebug</td><td class="CDLDefinition"><p>boolean that states whether in debug mode or not.</p></td></tr><tr><td class="CDLEntry">columnData</td><td class="CDLDefinition"><p>array of characters that contain the messages to be sent</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>tilt</p></td></tr><tr><td class="CDLEntry">2</td><td class="CDLDefinition"><p>tilt and soil moisture</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:operation" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,48);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >operation</a></p></li></ul></div>
</div>

<a name="send_thru_xbee"></a><a name="Topic55"></a><div class="CTopic TFunction LC">
 <div class="CTitle">send_thru_xbee</div>
 <div class="CBody"><p>Despacito Quiero respirar tu cuello despacito Deja que te diga cosas al oído Para que te acuerdes si no estás conmigo</p><div class="CHeading">Parameters</div><p>n/a</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>tilt</p></td></tr><tr><td class="CDLEntry">2</td><td class="CDLDefinition"><p>tilt and soil moisture</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:send_data" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,50);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >send_data</a></p></li></ul></div>
</div>

<a name="get_xbee_flag"></a><a name="Topic56"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">get_xbee_flag</div>
 <div class="CBody"><p>Despacito Quiero respirar tu cuello despacito Deja que te diga cosas al oído Para que te acuerdes si no estás conmigo</p><div class="CHeading">Parameters</div><p>n/a</p><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">1</td><td class="CDLDefinition"><p>tilt</p></td></tr><tr><td class="CDLEntry">2</td><td class="CDLDefinition"><p>tilt and soil moisture</p></td></tr></table><div class="CHeading">See Also</div><ul><li><p><a href="../index.html#File:main.ino:send_thru_xbee" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,55);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >send_thru_xbee</a></p></li></ul></div>
</div>

</body></html>